# 概要
このリポジトリは2019年度後期プログラミング演習の課題です。  

# 課題要件
- [x] コンビニエンスストア運営側が画面上で、商品の価格、在庫数等の入力できるか。 
- [x] コンビニエンスストア運営側が画面上でSALE等よって、一部の商品の価格を変更できるか。 
- [x] お釣りが不足しないようレジ現金残高の管理できているか。 
- [x] 機械を電源オフにし、再起動したとき商品の最新の価格、在庫数と販売歴等が必要によって確認できるか。 
- [x] 必要によってセキュリティ関連捜査等のため、販売明細を販売時間、販売明細件(伝票番号、処理番号等を用いて)ごとに出力ができるか。 

# 実行するには
まず、このリポジトリをcloneする。

```terminal
$ git clone https://github.com/Takana-Norimasa/selfregi.git
```
Makefileを用いてコンパイルする。
```terminal
$ make
```

以下にmanagerとselfregiという実行ファイルが生成される。

```terminal
$ ls
LICENSE  README.md  a.out  data  manager  manager.c  selfregi  selfregi.c  struct_data.h
```

# 全体の構成

```terminal
.
├── LICENSE
├── Makefile
├── README.md
├── data
│   ├── create_data.pl
│   ├── product_data.csv
│   └── sales_log.csv
├── manager.c
├── selfregi.c
└── struct_data.h
```
各ファイルについて説明する
作成したプログラムは主に```selfregi.c```と```manager.c```の二つに分けられる。  

## selfregi.c
ユーザ（顧客）が直接操作するセルフレジのプログラム。
顧客が商品を選択してカートに入れて購入することができる。  

## manager.c
主に店舗側がデータを操作するときに使用する。   
具体的には後述する```product_data.csv```のデータを操作して、各商品のデータをインタラクティブに変更できるプログラムになっている。

## struct_data.h
共通して使用する構造体やそれらを使った関数をまとめたヘッダファイル。  
```selfregi.c```と```manager.c```でインクルードされている。


必要なログやデータは```data```ディレクトリにまとめて格納されている。  
## sales_log.csv
販売したデータの記録が格納されている。

## product_data.csv
商品の名前や値段のデータが格納されている。  

## create_data.pl
適当な商品データをランダムに生成するperlスクリプト。  
商品データとID、紙幣の数をリセットしたい場合は、

```terminal
$ perl data/create_data.pl > data/product_data.csv
```

とする。

## Makefile
実行ファイルを生成するMakefile。

```terminal
$ make
```

でmanagerとselfregiという二つの実行ファイルを生成できる。  
両方を削除する場合は、

```terminal
$ make clean
```
と実行する。

## LICENSE
githubで公開するためにライセンスを付与した。  
今回はMIT Licenseを採用した。

# 実装した機能
今回は課題要件の他に以下の機能を開発した。

- ページ式の商品閲覧画面
- 画面遷移（来たり戻ったりできる）
- 商品をブロック上に配置

# 使用する際の流れ
操作の仕方を使用する際の流れに沿って説明する。  
作成したプログラムは2つともコマンドを使った対話式のプログラムとなっている。  
必要なコマンドは一文字で、聞かれる際に選択肢が出てくるのでそれらを入力する流れになっている。  

## selfregi
### 1.オープニング画面
プログラム自体の軽い説明をする。  
Enterを押して次に進む。

### 2.商品選択画面
商品選択画面では以下のことができる。

1. 左にページを移動させる
1. 商品選択を終了して次に進む
1. 右にページを移動させる
1. カートに商品を追加する
1. カートの中身を確認する

それぞれの数字がコマンドに対応しており、1を押せばページが左に3を押せばページが右に移動する。  
もちろん、端までいったらそれ以上はいかないようになっている。
  
カートに商品を追加するを選ぶとプロダクトIDと個数を聞かれる。  
入力が完了するとカートに自動で追加される。

### 3.清算
カートに入っている商品と個数と値段が表形式で表示される。  
合計金額が表示され、支払いをするか確認する。  
支払いするならそのままログと外部データに書き込んで終了し、しないなら商品選択画面に戻る。

## manager
managerもselfregiと似たような手順になっている。

### 1.オープニング画面
プログラム自体の軽い説明をする。  
Enterを押して次に進む。

### 2.商品編集画面
商品編集画面では以下のことができる。

1. 左にページを移動させる
1. 商品選択を終了して次に進む
1. 右にページを移動させる
1. 商品のデータを修正する
1. セールに向けて全商品の価格を決まった割合だけ割引する

データを修正する場合、プロダクトIDを聞かれ、その後名前か値段か在庫のどれを変更するか確認する。  
これらの編集データは終了する際にすべて外部のデータに反映される。

